# Problems

1. в сети модуля есть `узлы` ввода-вывода
2. компонент соответствует узлу в глобальной сети рантайма
3. у каждого узла есть свой `ввод-вывод`

# Observations (старая реализация)

0. были только `absPortAddrs`
1. создавалось `nodeIO` с именами узлов `in`, `out`
   1.1 имена узлов игнорируются операторами
2. для модулей создавалось `netIO`, где `in` и `out` - узлы с инвертированным вводом-выводом
3. для константы модуля создавался узел в `netIO` с именем `const` где есть только вывод
4. для воркеров модуля алгоритм запускался в цикле рекурсивно
   4.1 алгоритм возвращал `nodeIO` который сохранялся в `netIO` по имени модуля
5. `netIO` и `net` маппились и передавались в коннектор, где сразу запускались
6. `nodeIO` и имя модуля передавались в `patchIO` где имена узлов `in` и `out` в port-адресах менялись на имя узла
   6.1 чтобы при возврате из рекурсии попасть в `netIO`, чтобы затем можно было их смаппить с адресами из родительского `net`

# Conclusion

узлы ввода-вывода были внутренними для сети модуля, они не возвращались из рекурсивного вызова и не попадали в `netIO` модуля-родителя

# New Implementation

Хочется избавиться от рекурсии и сделать плоский список узлов и соединений, чтобы в рантайме был простой цикл. Это подразевает избавить рантайм от понятия компонентов (только операторы и константы, как "особенные" типы узлов).

NOTE: `root` prefix may be omitted

```yaml
const: # map[addr]constMsg
  root.const.z[0]:
    type: int
    int: 42
ops:
  - ref: math.mul
    in: [root.mul.in.x[0]]
    out: [root.mul.out.x[0]]
ports:
  root.in.x[0]: 0 # addr(path,name,idx):buf
  root.out.y[0]: 0
  root.const.z[0]: 0
  root.mul.in.a[0]: 0
  root.mul.out.b[0]: 0
net:
  - from: root.in.x[0]
    to: [mul.in.a[0]]
  - from: mul.out.b[0]
    to: [mul.out.b[0]]
startPort: root.in.x[0] # it's an error but you get the idea
```

- бежим по портам и наполняем мапу адресов на каналы
- бежим по сети и спауним горутины для каждого соединения
- бежим по операторам, для каждого оператора собираем айо и передаем ему
- бежим по константам и для каждой поднимаем горутину что шлёт сообщение
- шлём сигнал в порт рута

(в этой схеме есть ошибка - у рута нет сигнал-порта, но кажется эту деталь можно опустить)
